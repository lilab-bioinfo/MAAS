---
title: "5.SNV correction"
output:
  html_document:
    df_print: paged
vignette:  >
  %\VignetteIndexEntry{5.SNV correction} 
   %\VignetteEngine{knitr::rmarkdown}
   %\VignetteEncoding{UTF-8}
lang: "en-US"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  echo=TRUE,
  progress =FALSE,
  comment = "#>"
)
options(rmarkdown.html_vignette.check_title = FALSE)
```

We have conducted benchmark of several SNV denoising tools designed for single-cell data, and found that CBM show superior performance (please refer to our paper for more details). Users should install and run [CBM](https://github.com/zhyu-lab/cbm) before running MAAS. \

In this tutorial, CBM has been installed in `~/App/cbm-main`.

```{octave, message=FALSE, warning=FALSE, eval=FALSE}
library(dplyr)
library(data.table)
library(stringr)

#
input_file <- "../6.snvcorrection/snv.CBMinput.txt"
# sample.tmp <- gsub("\\.snv\\.CBMinput\\.txt", "", file.tmp)
output_file <- "./"
cmd <- paste("~/App/cbm-main/bin/cbm -i", input_file, "-o", output_file, "-K 10")
system(cmd)

#
pred.cluster.genotype <- as.data.frame(fread(".clones.txt"))
rownames(pred.cluster.genotype) <- 0:(nrow(pred.cluster.genotype)-1)
pred.cluster.label <- fread(".assignment.txt")
pred.cluster.label <- as.data.frame(t(pred.cluster.label))
colnames(pred.cluster.label) <- "Cluster"

pred <- do.call(rbind, lapply(pred.cluster.label$Cluster, function(cluster) {
  pred.cluster.genotype[as.character(cluster), ]
}))

raw.snv <- readRDS("snv.mat.rds")
rownames(pred) <- colnames(raw.snv)
colnames(pred) <- rownames(raw.snv)
saveRDS(pred, "denoised.mat.rds")

```
